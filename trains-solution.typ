#import "@preview/wrap-it:0.1.1": *

#set text(font: "JetBrains Mono")

#let sep = box(place(top+left, dy: -0.6em, dx: -0.25em, text(size: 0.8em, fill: gray, ".")))
#let sep-bar = box(place(top+left, dy: -0.65em, dx: -0.25em, text(size: 0.8em, fill: gray, "|")))

#set page(
  paper: "a4",
  margin: (x: 1cm, y: 1cm),
  header: [#align(center, [DRSS Institut])],
  footer: [#grid(columns: (auto, 1fr, auto), [9#[#sep]22#[#sep]3#[#sep]1#[#sep]4#[#sep]1#[#sep]14], [], [Přepisový formulář DaI\#25])]
)


// #let wave-ascii = block(par(leading: 0.5em, text(size: 4pt,
//   "a
//       ⡇⡀  ⡀⡀         ⣾⣀⣄⢀⣀⣀⢠⡀⡀⢀⢀⣠ ⡄⢠ ⡀   ⢀⣧⣿⡆       ⢀⡀        
// ⣦⣠⣤⣄⣠⣧⣷⣦⣄⣿⣧⣿⣦⣷⣤⣾⣤⣤⣧⣶⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣧⣾⣿⣷⣆⣤⣴⣾⣿⣿⣷⣿⣷⣿⣿⣷⣿⣼⣿⣷⣤⣷⣿⣿⣿⣾⣶⣶
// ⠟⠙⠛⠋⠙⡟⡿⠟⠋⣿⡟⣿⠟⡿⠛⢿⠛⠛⡟⠿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡟⢿⣿⡿⠏⠛⠻⢿⣿⣿⡿⣿⡿⣿⣿⡿⣿⢻⣿⡿⠛⡿⣿⣿⣿⢿⠿⠿
//       ⡇⠁  ⠁⠁         ⢿⠉⠋⠈⠉⠉⠘⠁⠁⠈⠈⠙ ⠃⠘ ⠁   ⠈⡟⣿⠇       ⠈⠁        
//   "
// )))
#let wave-ascii = image("images/audio.svg", height: 2.5em)

#let sender-img = block(stroke: none,// {{{
  par(leading: 0.3em, text(font: "JetBrains Mono", size: 4.5pt, "######***********%%%*+=+**#@@@@@@@@@@@@@@@@@@@@%%#***++=====-:-=*+#@@@@@@%%*:....:::::::..
%#########******%%#**+*#***%%***#%@@@@@@@%#*===-::::::::... .....:-=*@@@@@@@@=.:::::::::..
%%%########***%@@%%%**#%%%%%#**%@@@@@@@#*+=-::::::........  ........::*@@@@@@@+.::::::::::
%%%%#######***@@@%@%#*%@%%%%@@@@@@@@@#*==-:::............   .. .... ...-%@@@@@@=::::::::::
%%%%%%######*%@@@@%##%%%##%@@@@@@@@%*=--:::::........... ..   ..... ....:%@@@@@%::::::::::
%%%%%%#####*#@@@@@@%%@%%@@@@@@@@@@*=-:::::::............     ...........:-%@@@@%-:::::::::
%##%%%#####*%@@@@@@@@@@@@@@@@@@%#==-::::::::....... .                .....=@@@@%-:::::::::
%%#%%%%%####@@@@@@@@@@@%%@@@@%#*==--:::::::........ ..               .....:#@@@%::::::-:::
%%%%%%%%###%@@@@@@@@@@%%###*****+==-::::::::::.:........             ....::+@@@*::::---:::
%%%%%%%%%%%%@@@@@@@@@@%%##******+===-::::::....:...........       . ......:-@@%:::------::
%%%%%%%%%%%%@@@@@@@%%%%#%###****+===--::::::........... ... ..  ..........::#@*::-----::::
%%%%%%%%%%%%@@%%%%%%%##%%%###*****===---::::..............................::=%+-----------
%%%%%%%%%%#%%%%%%%%%#**#%%#####*+*****++===:::......... .... ..........:::::=%*---==------
%%%%%%%%%%#**%@@%%%#**#*###****+**%%%@@@%%#**+=::...::...:.........::.:::::-*%*========---
%%%%%%%%%###%@@@@@@@@@%%###***+*#%%%%%@@@@@@@@@%*-::::..:::.....::::--:::::-*#==========--
%%%%%%*=-+*#@@@@@@@@@@@@@@@%%%@@@%%%%%%%%@%##%@@%*-:--:::=:::===+*#%%%#*=-:-**============
%%%%%*+*%%%%%%%#%%@@%%%%%%@@@@*%@@@@@@@@@@@@%%%@@%*=+=::=+==*%%@@@@@@@@%#*--*=============
%%%%*%@@@@%@@@%#**#%%%%%#***%@@@@@@@@@@@@@@@@@%%@@@%%%+-=*=*@@@@@@%%%%%%%%*+#=============
%%%%*%@@@%%@@@@%**##%%%%%###%%%%@%%##%%%%%%@@@@@@%%%#*++*@@@@@@@@@@@@@%%*#%@%*============
%%%%%%@@@%%@@@@%####%%%%%%*++*####*+**+++=+*%@@%%*%*=:.:=%%%%%@@@@@@@@@@%==*@@%**=========
%%%%%%@@@%%@@@@%%#%%%%##*++===*+==+**++++==+*%@@@@@*::.:+#*+++=*#%%%%@@@%=-=%@%@%=========
%%%%%#%@%%@@@@%%%#%%%%#**#*+==+===+*+*+++==+***%%@%=::::+%+==**+==+==+#@%*#@@@*+=+=+++++++
%%%%%%#%%%@@@@%%%%###**#***+==-=-:::::--=---=+**%%*=-:::-#=====+*+=+==*@@@%%@*=+++++++++++
%%%%%%%%%%@@%@@%%###***#%%#%*+===:::::::::::+#*=+*+=-::::=+-:::--=====+##**+=-=++**+*+++++
%%%%%%%%%%%**%%%%###**#%%%%%%%****+++++=++==***##*=:::::::-+-:::::::--=++**-:-+*********+*
%@@%%%%%%%%##%@%%%#**#%%%%#***+====---::::=*#%%%#+-::::::::=*=-:::::::=+*+=::=************
@@@@%@%%@%%#%%%%%%####*******++==-------=*%%#%%%*=-:::::::::::=*+=---==-===:=*************
@@@@@@@@%++#%%@%%##%%#*##%%#*++====-===+#@@%%%@%#=-::::::--=-:::::::::-===--**************
@@@@@@@@@%%%%@@%%%%%%%%%%%%%#**+====+**#@@@@@@@@@%*==-======*+-:::::::-===-***************
@@@@@@@@@@@@%%%%%%%%%%@@%@@%#****++***#%@@@@@@@@@@@%%%%@%#=-*%*=::::::---==***************
@@@@@@@@@@@@##%%%@@%%%%%%%%%#******##%%%@@@@@@@@@@@%#***+=-==*@%+=-------=+##*************
@@@@@@@@@@@@##%%%@@%%@%%%%%#*++**##*#%%%%%%%%%%%###*+=========*@%*==-=====*#####**********
@@@@@@@@@@@@##%%@@@%@@@%#%%*===**+*%%@@%%%#***++==+=======+====*%#*======*%%##############
@@@@@@@@@@@@%#%%%@@@@@%%#%%*=-=#**%@@@@@@@@@@%#*=+=======+++====*#*=====*%%%%#############
@@@@@@@@@@@@%%%%%@@@@@@%%@%+=--+*+***#%%%#%%%%#*#%%%%%#####%#*+=+*=====+%%%%%%##%%#%######
@@@@@@@@@@@@@%%%%@@@@@@@%@%*=-:=+++****##****#==--:-===+%%%#%%*=++====+#%%%%%%%%%%%%%%%##%
@@@@@@@@@@@@@@%%%%@@@@@@@@@#*=-=+*++*******+++++*==++=+***+==*#*+====+#@@@@@%%%%%%%%%%%%#%
@@@@@@@@@@@@@@%%@@@@@@@@@@@%*+==+*++**#**========-::-=+++==--=+*+==+*#@@@@@@@@@@%%%%%%%%%%
@@@@@@@@@@@@@@@%@@@@@@@@@@@@%*+++**+=**###****++===--=====--===++=**#@@@@@@@@@@@@@@@@%%%%%
@@@@@@@@@@@@@@@@%@@@@@@@@@@@%%****++==+*************+++===-===+****%@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%#**++=======+*******++===---===***#%@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%**+====::-====+=+==------===**##@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%***===-:------------:--==+**#%@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%#*+===--------:::----==+*#%@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@%#%@@@@@@@@@@@@%%**+==-----==------==*#%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@%**@@@@@@@@@@@@@%%**+============+**%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@%**%@@@@@@@@@@@@@@%%#**+++**++**#%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@%**#%@@@@@@@@@@@@@@@@%%%%%%%%%%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@%#*#%@@@@@@@@@@@@@@@@@@@@@@*:=@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
")))// }}}


// #let body-grid = grid(
//   columns: 1,
//   [#wrap-content( sender-img, [#par(justify: true, lorem(500))], align: top + right, column-gutter: 1em)]
// )
//
#let text-intro = par[
]

#let input-alph-lookup = (
  "D": "D",
  "A": "A",
  "N": "N",
  // "h": "\u{2665}",
  "h": "&",
  "I": "I",
  "V": "V",
  "C": "C"
)

#let output-alph-lookup = (
  "L": "λ",
)

#let a-input-text(input) = {
  for c in input {
    [#input-alph-lookup.at(c)]
  }
}

#let a-transitions = (
        (("S0", "h"), ("S0", "L")),
        (("S0", "V"), ("S0", "n")),
        (("S0", "N"), ("S0", "(")),

        (("S0", "A"), ("S1", "m")),
        (("S0", "D"), ("S1", "f")),
        (("S0", "I"), ("S1", "n")),

        (("S1", "A"), ("S1", "x")),
        (("S1", "N"), ("S1", "n")),

        (("S1", "V"), ("S0", "f")),
        (("S1", "C"), ("S0", ".")),
        (("S1", "D"), ("S0", "(")),

        (("S1", "h"), ("S2", ")")),

        (("S2", "I"), ("S2", ")")),

        (("S2", "C"), ("S0", "(")),
)

#let state-lookup = (
  "S0": "B^",
  "S1": "%C",
  "S2": "$Z",
)

#let render-transition(tr) = {
  let start = tr.at(0).at(0)
  let end = tr.at(1).at(0)

  let input = tr.at(0).at(1)
  let output = tr.at(1).at(1)

  [#state-lookup.at(start) #input-alph-lookup.at(input)/#output-alph-lookup.at(output, default: output) #state-lookup.at(end)]
}

#let text-main = par[
  #set text(size: 0.7em)


  #image("./images/trains-solution/train-1.png", width: 200pt)
  #image("./images/trains-misc/1-7-solved.png", width: 200pt)
  #image("./images/trains-misc/3-7-solved.png", width: 200pt)
  #image("./images/trains-misc/4-4-solved.png", width: 200pt)



]

#let body-grid = grid(
  columns: 1,
  grid.cell(grid(
    columns: (1fr, 1fr),
    grid.cell(inset: 0.5em, text-intro),
    []
    // grid.cell(
    //   stroke: 1pt + black,
    //   inset: 0.7em,
    //   align(center + horizon, sender-img)
    // )
 
  )),
  grid.cell(inset: 0.5em, text-main)
)




#table(
  columns: (1fr, 1fr),

  align(horizon, text(weight: "bold", size: 1.2em, [Přepis přijaté zprávy])),
  [#wave-ascii],
  [*Zdroj:* 49.0364842N, 16.1206428E],
  [*Odesílatel:* Trains],
  table.cell(colspan: 2, inset: 0pt, [#body-grid]),
  table.cell(colspan: 2, inset: 0pt, table(
    columns: (1fr, 2fr, 1fr),
    align(center + horizon, rotate(90deg, reflow: true, image("images/three-body-logo-smaller.svg", height: 5em))),
    [],
    align(horizon + right, [20. 9. 2025])
  ))
)
